### How does Unintended Data Leakage work?
First, a developer’s code processes sensitive information supplied by the user or the backend. During that processing, a side-effect (that is unknown to the developer) results in that information being placed into an insecure location on the mobile device that other apps on the device may have open access to. Typically, these side-effects originate from the underlying mobile device’s operating system (OS). An attacker can simply write a small piece of code to access the location where the sensitive information is stored.

Below you can find examples of unintended data leakage in Android OS:
 
• URL Caching (Both request and response)
  
• Keyboard Press Caching
  
• Copy/Paste buffer Caching

• Application backgrounding

• Logging

• Analytics data sent to 3rd parties
  
  <br><br>
  
#### 3.1 Information Disclosure through Logcat/Apple System Log (ASL) Logging

Android `Logs` is a great place to look for information leakage. Logging techniques are generally used by developers for debugging purposes during their application development.
In the below scenario I will explain how sensitive information could be leaked via Android logs using `adb` tool.
First step using `adb` tool we can start using `adb logcat` so we can check how the application log the data, so simply we can use the following command to save the output in a text file `adb logcat > logs.txt` as shown below:

![image](https://user-images.githubusercontent.com/48615614/203750274-7f531c64-bef3-4567-9731-59c1479a9f02.png)

As you can see below I will try to login to the online banking application `InsecureBankv2` with username `dinesh` and password `Dinesh@123$`.

![image](https://user-images.githubusercontent.com/48615614/203750387-28cfe67d-0712-4d8e-90f4-b0d5597b91dd.png)

Now we can start investigate on the logs files `logs.txt` to check if the application logging a sensitive information such as the username and password or not:
By using grep on the text file as shown below:
![image](https://user-images.githubusercontent.com/48615614/203750506-86867dc7-cc6c-4d42-b7ce-85bb2bb04614.png)

By using `cat logs.txt | grep "dinesh"` command I was able to find the username and password in a clear text which is Unintended Data Leakage vulnerability.


<br>

#### 3.2 Exposing Device Specific Identifiers in Attacker Visible Elements

where apps use third party APIs. Using this app, the third party APIs may read sensitive information such as device ID and location from the device.

3rd party services are mostly implemented in two ways:
	• By using a standalone library, like a Jar in an Android project that is getting included into the APK.
	• By using a full SDK.

#### Static Analysis
Some 3rd party libraries can be automatically integrated into the app through a wizard within the IDE. The permissions set in the AndroidManifest.xml when installing a library through an IDE wizard should be reviewed. Especially permissions to access SMS `READ_SMS`, contacts `READ_CONTACTS` or the location `ACCESS_FINE_LOCATION` should be challenged if they are really needed to make the library work at a bare minimum, see also Testing App Permissions. When talking to developers it should be shared to them that it’s actually necessary to have a look at the differences on the project source code before and after the library was installed through the IDE and what changes have been made to the code base.

The same thing applies when adding a library or SDK manually. The source code should be checked for API calls or functions provided by the 3rd party library or SDK. The applied code changes should be reviewed and it should be checked if available security best practices of the library and SDK are applied and used.
The libraries loaded into the project should be reviewed in order to identify with the developers if they are needed and also if they are out of date and contain known vulnerabilities.


#### Dynamic Analysis
All requests made to external services should be analyzed if any sensitive information is embedded into them. Dynamic analysis can be performed by launching a Man-in-the-middle (MITM) attack using Burp Suite Professional or OWASP ZAP, to intercept the traffic exchanged between client and server. Once we are able to route the traffic to the interception proxy, we can try to sniff the traffic from the app to the server and vice versa. When using the app all requests that are not going directly to the server where the main function is hosted should be checked, if any sensitive information is sent to a 3rd party. This could be for example PII (Personal Identifiable Information) in a tracker or ad service.

#### Remediation
All data that is sent to 3rd Party services should be anonymized, so no PII data is available. Also all other data, like IDs in an application that can be mapped to a user account or session should not be sent to a third party.
AndroidManifest.xml should only contain the permissions that are absolutely needed to work properly and as intended.

<br>

#### 3.3 URL Caching (HTTP Request and Response)

There have been plenty of issues with web view based applications which leak URLs, cookies and cached information on the device, which allows an attacker to take over the session of the user. This caching could be in any form including logs, web history, web cache, etc.
We can filter the logcat output using grep and inspect the logs for sensitive information such as cookies with the command shown below.
`adb logcat | grep “cookie”`
Many applications do not disable caching of the applications. This can be easily avoided using HTTP’s caching headers such as `no-cache`, `no-store`.
There are numerous vulnerabilities reported on this. Please look at the references at the end of the article for more information on this.

<br>

#### 3.4 Keyboard Press Caching

When typing in data into input fields, the software keyboard automatically suggests what data the user might want to key in. This feature can be very useful in messaging apps to write text messages more efficiently. For input fields that are asking for sensitive information like credit card data the keyboard cache might disclose sensitive information already when the input field is selected.

#### Static Analysis
In the layout definition of an activity, TextViews can be defined that have XML attributes. When the XML attribute android:inputType is set with the constant textNoSuggestions the keyboard cache is not shown if the input field is selected. Only the keyboard is shown and the user needs to type everything manually and nothing is suggested to him.

   `<EditText
        android:id="@+id/KeyBoardCache"
        android:inputType="textNoSuggestions"/>
`

#### Dynamic Analysis
Start the app and click into the input fields that ask for sensitive data. If strings are suggested the keyboard cache is not disabled for this input field.
Remediation
All input fields that ask for sensitive information, should implement the following XML attribute to disable the keyboard suggestions:

`android:inputType="textNoSuggestions"`

https://developer.android.com/reference/android/text/InputType.html#TYPE_TEXT_FLAG_NO_SUGGESTIONS

<br>

#### 3.5 Copy/paste buffer caching

Copy/paste buffer caching is one more dangerous problems in Android devices. If a user copies any sensitive information such as credit card number to the clip board, an attacker can easily read it.

sensitive data leakage can occur is from the clipboard. Users tend to copy/paste quite a lot on mobile devices as its easier than typing. If the application allows for the copy/paste of sensitive information from one app to another then it is possible that a malicious application could read it also.

In the below scenario I will explain how can I read the clipboard using `post.capture.clipboard module in Drozer.

First of all we need to install this module using the following command `module install clipboard` as shown below:

![image](https://user-images.githubusercontent.com/48615614/203761279-45857878-c5e6-4b8a-a257-2adea52d691c.png)

In the below screenshot simulate a user could take a copy from a sensitive data:

![image](https://user-images.githubusercontent.com/48615614/203761337-24b14c12-7b68-4821-b1a6-162455da4c1b.png)

I was able to read the clipboard using the `post.capture.clipboard` module in Drozer using the following command `run post.capture.clipboard`:

![image](https://user-images.githubusercontent.com/48615614/203761545-3fa3039c-8820-4220-8570-a7a64bbbf2ae.png)

<br>

#### 3.6 Application Backgrounding (Screenshot)
Android OS take screenshots of the application before backgrounding the application for improving perceived performance of the application reactivation.
These screenshots are a cause of security concern due to the potential leak of customer data.

In the screenshot below I was able to take a screenshot from the online banking application in the background showing a sensitive information:

![image](https://user-images.githubusercontent.com/48615614/203761685-33caf1f6-62e1-4f86-a60b-560c8375fd35.png)










